function get_config(){var i=localStorage.getItem("configStorage");return i?JSON.parse(i):config}function save_config(){localStorage.setItem("configStorage",JSON.stringify(config)),console.log(config)}function run_action(i){$.ajax({url:i,type:"GET"}).done(function(){}).fail(function(i,n,t){}).always(function(){})}function config_init(){config=get_config(),console.log(config),$("#cam_ip").val(config.ip),base_url="http://"+config.ip+"/cgi-bin",config_setting("flip",config.flip),config_setting("mirror",config.mirror),config_setting("invertcontrols",config.invertcontrols),config_setting("infinitypt",config.infinitypt),config_setting("infinityzoom",config.infinityzoom),config_setting("infinityfocus",config.infinityfocus),$("#panspeed").val(config.panspeed),$("#zoomspeed").val(config.zoomspeed),$("#tiltspeed").val(config.tiltspeed),$("#focusspeed").val(config.focusspeed),$("#autopaninterval").val(config.autopaninterval),1==config.infinitypt?$("#pt_infinity").show():$("#pt_infinity").hide(),1==config.infinityzoom?($("#cam_zoom_infinity").show(),$("#cam_zoom_standard").hide()):($("#cam_zoom_infinity").hide(),$("#cam_zoom_standard").show()),1==config.infinityfocus?($("#cam_focus_infinity").show(),$("#cam_focus_standard").hide()):($("#cam_focus_infinity").hide(),$("#cam_focus_standard").show()),update_labels()}function config_setting(i,n){var t=base_url+"/param.cgi?post_image_value&"+i+"&"+n;run_action(t)}function update_labels(){switch(config.flip){case 0:$("#flip").html("Flip-No");break;case 1:$("#flip").html("Flip-Yes")}switch(config.mirror){case 0:$("#mirror").html("Mirror-No");break;case 1:$("#mirror").html("Mirror-Yes")}switch(config.invertcontrols){case 0:$("#invertcontrols").html("Invert Controls-No");break;case 1:$("#invertcontrols").html("Invert Controls-Yes")}switch(config.infinitypt){case 0:$("#infinitypt").html("Infinity Pan/Tilt-No");break;case 1:$("#infinitypt").html("Infinity Pan/Tilt-Yes")}switch(config.infinityzoom){case 0:$("#infinityzoom").html("Infinity Zoom-No");break;case 1:$("#infinityzoom").html("Infinity Zoom-Yes")}switch(config.infinityfocus){case 0:$("#infinityfocus").html("Infinity Focus-No");break;case 1:$("#infinityfocus").html("Infinity Focus-Yes")}config.ip=$("#cam_ip").val()}function reload_cam(){config.ip=$("#cam_ip").val(),/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(config.ip)?(config.ip=config.ip,save_config(),alert("New IP address saved.")):alert("IP address entered is invalid! Re-enter camera IP address.")}function adjust_setting(i){switch(i){case"flip":switch(config.flip){case 0:var n=base_url+"/param.cgi?post_image_value&flip&1";run_action(n),config.flip=1,save_config(),update_labels();break;case 1:var n=base_url+"/param.cgi?post_image_value&flip&0";run_action(n),config.flip=0,save_config(),update_labels()}break;case"mirror":switch(config.mirror){case 0:var n=base_url+"/param.cgi?post_image_value&mirror&1";run_action(n),config.mirror=1,save_config(),update_labels();break;case 1:var n=base_url+"/param.cgi?post_image_value&mirror&0";run_action(n),config.mirror=0,save_config(),update_labels()}break;case"invertcontrols":switch(config.invertcontrols){case 0:config.invertcontrols=1,save_config(),update_labels();break;case 1:config.invertcontrols=0,save_config(),update_labels()}break;case"infinitypt":switch(config.infinitypt){case 0:config.infinitypt=1,$("#pt_infinity").show(),config.infinitypt=1,save_config(),update_labels();break;case 1:config.infinitypt=0,$("#pt_infinity").hide(),config.infinitypt=0,save_config(),update_labels()}break;case"infinityzoom":switch(config.infinityzoom){case 0:config.infinityzoom=1,$("#cam_zoom_infinity").show(),$("#cam_zoom_standard").hide(),config.infinityzoom=1,save_config(),update_labels();break;case 1:config.infinityzoom=0,$("#cam_zoom_infinity").hide(),$("#cam_zoom_standard").show(),config.infinityzoom=0,save_config(),update_labels()}break;case"infinityfocus":switch(config.infinityfocus){case 0:config.infinityfocus=1,$("#cam_focus_infinity").show(),$("#cam_focus_standard").hide(),config.infinityfocus=1,save_config(),update_labels();break;case 1:config.infinityfocus=0,$("#cam_focus_infinity").hide(),$("#cam_focus_standard").show(),config.infinityfocus=0,save_config(),update_labels()}}}function update_settings(){switch(config.flip){case 0:var i=base_url+"/param.cgi?post_image_value&flip&0";run_action(i);break;case 1:var i=base_url+"/param.cgi?post_image_value&flip&1";run_action(i)}switch(config.mirror){case 0:var i=base_url+"/param.cgi?post_image_value&mirror&0";run_action(i),update_labels();break;case 1:var i=base_url+"/param.cgi?post_image_value&mirror&1";run_action(i),update_labels()}switch(config.infinitypt){case 0:$("#pt_infinity").hide();break;case 1:$("#pt_infinity").show()}switch(config.infinityzoom){case 0:$("#cam_zoom_infinity").hide(),$("#cam_zoom_standard").show();break;case 1:$("#cam_zoom_infinity").show(),$("#cam_zoom_standard").hide()}switch(config.infinityfocus){case 1:$("#cam_focus_infinity").hide(),$("#cam_focus_standard").show();break;case 0:$("#cam_focus_infinity").show(),$("#cam_focus_standard").hide()}update_labels()}function cam_pantilt(i,n){switch(n){case"left":if("1"==config.invertcontrols)var t=base_url+"/ptzctrl.cgi?ptzcmd&right&"+config.panspeed+"&"+config.tiltspeed;else var t=base_url+"/ptzctrl.cgi?ptzcmd&left&"+config.panspeed+"&"+config.tiltspeed;break;case"right":if("1"==config.invertcontrols)var t=base_url+"/ptzctrl.cgi?ptzcmd&left&"+config.panspeed+"&"+config.tiltspeed;else var t=base_url+"/ptzctrl.cgi?ptzcmd&right&"+config.panspeed+"&"+config.tiltspeed;break;case"up":if("1"==config.invertcontrols)var t=base_url+"/ptzctrl.cgi?ptzcmd&down&"+config.panspeed+"&"+config.tiltspeed;else var t=base_url+"/ptzctrl.cgi?ptzcmd&up&"+config.panspeed+"&"+config.tiltspeed;break;case"down":if("1"==config.invertcontrols)var t=base_url+"/ptzctrl.cgi?ptzcmd&up&"+config.panspeed+"&"+config.tiltspeed;else var t=base_url+"/ptzctrl.cgi?ptzcmd&down&"+config.panspeed+"&"+config.tiltspeed;break;case"home":var t=base_url+"/ptzctrl.cgi?ptzcmd&home&"+config.panspeed+"&"+config.tiltspeed;break;case"stop":var t=base_url+"/ptzctrl.cgi?ptzcmd&ptzstop"}run_action(t)}function cam_zoom(i,n){var t=base_url+"/ptzctrl.cgi?ptzcmd&"+n+"&"+config.zoomspeed;run_action(t)}function cam_focus(i,n){var t=base_url+"/ptzctrl.cgi?ptzcmd&"+n+"&"+config.focusspeed;run_action(t)}function cam_preset(i,n,t){var a=base_url+"/ptzctrl.cgi?ptzcmd&"+t+"&"+n;run_action(a)}function autopan(){var i=config.autopaninterval;autopanning=!0,cam_preset(1,11,"poscall"),setTimeout(function(){console.log("start panning right"),pan("right"),autoInterval=setInterval(function(){"left"==panning?(clearInterval(panInterval),console.log("start panning right"),pan("right")):"right"==panning&&(clearInterval(panInterval),console.log("start panning left"),pan("left"))},1e3*i)},1e3)}function pan(i){var n=1,t=1;panInterval=setInterval(function(){if("left"==i){if(panning="left","1"==config.invertcontrols)var a=base_url+"/ptzctrl.cgi?ptzcmd&right&"+n+"&"+t;else var a=base_url+"/ptzctrl.cgi?ptzcmd&left&"+n+"&"+t;console.log("...pan left")}else if("right"==i){if(panning="right","1"==config.invertcontrols)var a=base_url+"/ptzctrl.cgi?ptzcmd&left&"+n+"&"+t;else var a=base_url+"/ptzctrl.cgi?ptzcmd&right&"+n+"&"+t;console.log("...pan right")}run_action(a)},1e3)}function stop_autopan(){autoInterval&&clearInterval(autoInterval),panInterval&&clearInterval(panInterval),autopanning=!1,cam_pantilt(1,"stop"),$(".autopan").removeClass("active")}function clear_active_preset(){$(".preset_image").removeClass("active")}var camera_ip="192.168.0.190",base_url="http://"+camera_ip+"/cgi-bin",defaults={ip:camera_ip,flip:1,mirror:1,invertcontrols:1,infinitypt:0,infinityzoom:0,infinityfocus:0,panspeed:8,zoomspeed:5,tiltspeed:8,focusspeed:3,autopaninterval:60},config=defaults;config.ip=camera_ip,config_init();var autoInterval,panInterval,panning,autopanning=!1;$("body").on("click",".autopan",function(i){return i.preventDefault(),clear_active_preset(),cam_pantilt(1,"stop"),0==autopanning?(autopan(),$(this).addClass("active")):stop_autopan(),!1}),$("body").on("click",".adjust_setting",function(i){i.preventDefault();var n=$(this).data("action");return adjust_setting(n),!1}),$("body").on("change","select.change_setting",function(i){i.preventDefault();var n=$(this).attr("id");return config[n]=$(this).val(),save_config(),!1}),$("body").on("click",".call_preset",function(i){i.preventDefault(),stop_autopan();var n=$(this).data("preset");return cam_preset(1,n,"poscall"),clear_active_preset(),$(this).addClass("active"),!1}),$("body").on("click",".assign_preset",function(i){i.preventDefault();var n=$(this).val();return"Auto Pan Left Start Position"==n&&(n=11),cam_preset(1,n,"posset"),!1}),$("body").on("click",".reload_cam",function(i){return i.preventDefault(),reload_cam(),!1}),Mousetrap.bind("up",function(i){return stop_autopan(),cam_pantilt(1,"up"),$(".pantilt-up").addClass("active"),!1},"keydown"),Mousetrap.bind("up",function(i){return cam_pantilt(1,"stop"),$(".pantilt-up").removeClass("active"),!1},"keyup"),Mousetrap.bind("down",function(i){return stop_autopan(),cam_pantilt(1,"down"),$(".pantilt-down").addClass("active"),!1},"keydown"),Mousetrap.bind("down",function(i){return cam_pantilt(1,"stop"),$(".pantilt-down").removeClass("active"),!1},"keyup"),Mousetrap.bind("left",function(i){return stop_autopan(),cam_pantilt(1,"left"),$(".pantilt-left").addClass("active"),!1},"keydown"),Mousetrap.bind("left",function(i){return cam_pantilt(1,"stop"),$(".pantilt-left").removeClass("active"),!1},"keyup"),Mousetrap.bind("right",function(i){return stop_autopan(),cam_pantilt(1,"right"),$(".pantilt-right").addClass("active"),!1},"keydown"),Mousetrap.bind("right",function(i){return cam_pantilt(1,"stop"),$(".pantilt-right").removeClass("active"),!1},"keyup"),Mousetrap.bind("a",function(i){return stop_autopan(),cam_zoom(1,"zoomin"),clear_active_preset(),!1},"keydown"),Mousetrap.bind("a",function(i){return cam_zoom(1,"zoomstop"),!1},"keyup"),Mousetrap.bind("z",function(i){return stop_autopan(),cam_zoom(1,"zoomout"),clear_active_preset(),!1},"keydown"),Mousetrap.bind("z",function(i){return cam_zoom(1,"zoomstop"),!1},"keyup"),Mousetrap.bind("command+.",function(i){return $("#set_presets").modal("toggle"),!1}),Mousetrap.bind("command+,",function(i){return $("#cam_adjust_control_settings").modal("toggle"),!1});const app=require("electron").app;app.on("window-all-closed",function(){cam_pantilt(1,"stop")});